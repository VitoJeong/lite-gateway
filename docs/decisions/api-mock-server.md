# 테스트용 API Mock 서버 구성

> 이 문서는 Lite Gateway의 테스트용 Mock 서버 구성에 대한 결정 사항을 기록한다.

## 목적

- 게이트웨이 라우팅 및 필터 체인 처리 로직을 **통합 테스트** 수준에서 검증
- 실제 HTTP 프록시 요청이 발생하는지, 필터 적용 여부와 응답 결과를 확인하고자 함
- 실제 API 서버를 사용해서 테스트를 하면, 서버 상태에 따라 테스트의 결과가 달라지는 것을 방지하기 위함

## 대안 비교

| 도구                                 | 장점                              | 단점              | 평가                  |
| ---------------------------------- | ------------------------------- | --------------- | ------------------- |
| **MockWebServer (OkHttp)**         | 매우 경량, 빠름, Kotlin 친화            | 조건부 매칭/요청 추적 불가 | ✅ 단순 테스트에 적합        |
| **WireMock**                       | 조건 기반 요청 매칭, 요청 히스토리 검증, DSL 강력 | 약간 무거움          | ✅✅ 실전 게이트웨이 테스트에 적합 |
| **MockK + WebClient Stub**         | 단위 테스트에 적합                      | 실제 HTTP 흐름 없음   | ❌                   |
| **TestRestTemplate + @Controller** | 설정 간단                           | 프록시 동작 테스트엔 부적절 | ❌                   |

## 최종 선택: WireMock

### 이유

- 라우팅 및 필터 처리 후 조건부 라우팅, 프록시 요청 검증 등 게이트웨이 주요 기능 테스트에 적합
- Spring Context 외부에서 독립적으로 동작하여 테스트 분리도 용이
- 게이트웨이 기능 확장에도 유연하게 대응 가능